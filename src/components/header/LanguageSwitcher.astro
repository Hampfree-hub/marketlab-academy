---
/*
  LanguageSwitcher Component
  Handles switching between RU, EN, ES via URL path.
*/
import { languages } from '../../i18n/ui';
import { getLangFromUrl, useTranslations } from '../../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Utility to switch language in current URL
const getSwitchPath = (targetLang: string) => {
	const currentPath = Astro.url.pathname;
	const pathParts = currentPath.split('/').filter(Boolean);
	// URL format: /[lang]/...
	// index 0: "[lang]", index 1: "library" or "about", etc.
	const langIndex = 0;
	
	if (pathParts.length > 0 && ['ru', 'en', 'es'].includes(pathParts[langIndex])) {
		pathParts[langIndex] = targetLang;
		let newPath = '/' + pathParts.join('/');
		if (!newPath.endsWith('/')) newPath += '/';
		return newPath;
	}
	return `/${targetLang}/`;
};
---

<div class="lang-switcher" aria-label={t('mobile.lang_label')}>
	{Object.keys(languages).map((l, index) => (
		<>
			<a 
				href={getSwitchPath(l)}
				class={`lang-btn ${lang === l ? 'active' : ''}`} 
				data-lang={l}
			>
				{l.toUpperCase()}
			</a>
			{index < Object.keys(languages).length - 1 && <span class="lang-divider">|</span>}
		</>
	))}
</div>

<style>
	.lang-switcher {
		display: flex;
		align-items: center;
		gap: 4px;
		font-family: 'Press Start 2P', monospace;
		font-size: 0.75rem;
	}
	.lang-btn {
		background: transparent;
		border: none;
		color: var(--color-text-secondary);
		cursor: pointer;
		padding: 4px 8px;
		transition: color 0.2s steps(3);
	}
	.lang-btn:hover {
		color: var(--nes-accent-green);
	}
	.lang-btn.active {
		color: var(--nes-accent-green);
		font-weight: bold;
	}
	.lang-divider {
		color: var(--nes-border-primary);
		opacity: 0.5;
	}
</style>
