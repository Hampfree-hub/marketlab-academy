---
/*
  LanguageSwitcher Component
  Handles switching between RU, EN, ES via URL path.
*/
import { languages, ui } from '../../i18n/ui';
import { getLangFromUrl, useTranslations } from '../../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<div class="lang-switcher" aria-label={t('mobile.lang_label')}>
	{Object.keys(languages).map((l, index) => (
		<>
			<button 
				class={`lang-btn ${lang === l ? 'active' : ''}`} 
				data-lang={l}
					onclick={`
						const currentPath = window.location.pathname;
						const pathParts = currentPath.split('/');
						const langIndex = pathParts.findIndex(p => p === 'marketlab-academy') + 1;
						
						// Keep menu open after reload
						const suffix = '?menu=open';
						
						if (langIndex > 0 && langIndex < pathParts.length) {
							pathParts[langIndex] = '${l}';
							// Ensure trailing slash
							let newPath = pathParts.join('/');
							if (!newPath.endsWith('/')) newPath += '/';
							window.location.href = newPath + suffix;
						} else {
							window.location.href = '/marketlab-academy/${l}/' + suffix;
						}
					`}
			>
				{l.toUpperCase()}
			</button>
			{index < Object.keys(languages).length - 1 && <span class="lang-divider">|</span>}
		</>
	))}
</div>
