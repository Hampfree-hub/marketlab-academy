---
/*
  MobileMenu Component
  Includes navigation links, language switcher and theme toggle for mobile view.
*/
import { getLangFromUrl, useTranslations, useTranslatedPath } from '../../i18n/utils';
import { languages } from '../../i18n/ui';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

const currentPath = Astro.url.pathname;
const isLibrary = currentPath.includes('/library');
const isAbout = currentPath.includes('/about');

// Utility to switch language in current URL
const getSwitchPath = (targetLang: string) => {
	const pathParts = currentPath.split('/').filter(Boolean);
	// URL format: /[lang]/...
	// index 0: "[lang]", index 1: "library" or "about", etc.
	const langIndex = 0;
	
	if (pathParts.length > 0 && ['ru', 'en', 'es'].includes(pathParts[langIndex])) {
		pathParts[langIndex] = targetLang;
		let newPath = '/' + pathParts.join('/');
		if (!newPath.endsWith('/')) newPath += '/';
		return newPath;
	}
	return `/${targetLang}/`;
};
---

<!-- MOBILE MENU -->
<div id="mobile-menu" class="mobile-menu" aria-label={t('mobile.menu_aria_label')}>
	<nav class="mobile-nav-links">
		<a href={translatePath('library')} class={isLibrary ? 'active' : ''} aria-current={isLibrary ? 'page' : undefined}>[{t('nav.library')}]</a>
		<a href={translatePath('about')} class={isAbout ? 'active' : ''} aria-current={isAbout ? 'page' : undefined}>[{t('nav.about')}]</a>
	</nav>
	
	<!-- Mobile: Languages -->
	<div class="mobile-lang-switcher">
		<span class="mobile-menu-label">{t('mobile.lang_label')}</span>
		<div class="mobile-lang-buttons">
			{Object.keys(languages).map((l) => (
				<a 
					href={getSwitchPath(l) + '?menu=open'}
					class={`lang-btn-mobile ${lang === l ? 'active' : ''}`} 
					data-lang={l}
				>
					{l.toUpperCase()}
				</a>
			))}
		</div>
	</div>
	
	<!-- Mobile: Theme -->
	<div class="mobile-theme-switcher">
		<button id="theme-toggle-mobile" class="theme-btn-mobile" aria-label={t('theme.toggle')}>
			<svg class="theme-icon-mobile" viewBox="0 0 16 16" fill="currentColor">
				<rect x="6" y="0" width="4" height="2"/>
				<rect x="6" y="14" width="4" height="2"/>
				<rect x="0" y="6" width="2" height="4"/>
				<rect x="14" y="6" width="2" height="4"/>
				<rect x="4" y="4" width="8" height="8"/>
			</svg>
			<span class="theme-label">{t('mobile.theme_label')}</span>
		</button>
	</div>
</div>

<style>
	.mobile-nav-links {
		display: flex;
		flex-direction: column;
		gap: 8px; /* ✅ Issue #52: Исправлено на кратно 8px (было 0.75rem = 12px) */
	}
</style>
